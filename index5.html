<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Contour finder</title>
  <link rel="stylesheet" href="css/normalize.css">
  <script src="js/jquery-1.10.1.min.js" type="text/javascript"></script>
  <script src="js/ContourFinder.js" type="text/javascript"></script>
  <script>
  
		var image;
		var imageCtx;
		var logo
		var foregroudColor = 255;
		var backgroundColor = 0;
		//var threshold = 160; //doodle3D logo
		var threshold = 62; //arcade
		//var threshold = 120; //circus
		var contourFinder = new ContourFinder();
		var startTime = 0;
    var currentContour = 0;

		$( document ).ready(function() {
		  console.log( "ready!" );
		  image = document.getElementById('image');
			imageCtx = image.getContext('2d');
			
			fillImage();
			
			$(document).click(onClick);
			$(document).bind("touchstart",onClick);
		});
		function onClick() {
			startTime = Date.now();
			// ToDo: try edge detection filter
			// ToDo: preprocess: threshold
			contourFinder.findContours(image,foregroudColor,backgroundColor,threshold);
			
      console.log("contourFinder.allpoints.length): " + contourFinder.allpoints.length);
			//alert(Date.now()-startTime);

      imageCtx.clearRect(0,0,1000,1000);

      for (var i=0; i<contourFinder.allpoints.length; i++) {
        imageCtx.strokeStyle = '#'+Math.floor(Math.random()*16777215).toString(16);
        drawContour(i);
      }

      // console.log(contourFinder.getPoints());
		}
		function fillImage() {
			//imageCtx.clearRect (0,0,image.width,image.height);
		
			logo = new Image();
	    logo.onload = draw;
	    //logo.src = "images/logo.png";
	    logo.src = "images/hart.png";
			//logo.src = "images/circus.jpg";
		}
		function draw() {
			imageCtx.drawImage(logo, 0, 0); 
		}
		
		function drawContours() {
			
		}

    function drawContour(index) {
      var points = contourFinder.allpoints[index];
      if (points.length<=0) return;

      imageCtx.beginPath();
      imageCtx.moveTo(points[0][0],points[0][1]); 
      for (var i=0; i<points.length; i++) {
        imageCtx.lineTo(points[i][0],points[i][1]);
      }
      imageCtx.stroke();
    }
    
  	
  </script>
</head>
<body>
	<canvas id="image" width="1024" height="768"></canvas>
</body>
</html>